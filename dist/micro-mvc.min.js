(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.mvc=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}module.exports=_assertThisInitialized},{}],2:[function(require,module,exports){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}module.exports=_classCallCheck},{}],3:[function(require,module,exports){var setPrototypeOf=require("./setPrototypeOf");function isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function _construct(Parent,args,Class){if(isNativeReflectConstruct()){module.exports=_construct=Reflect.construct}else{module.exports=_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)setPrototypeOf(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}module.exports=_construct},{"./setPrototypeOf":10}],4:[function(require,module,exports){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}module.exports=_createClass},{}],5:[function(require,module,exports){function _getPrototypeOf(o){module.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}module.exports=_getPrototypeOf},{}],6:[function(require,module,exports){var setPrototypeOf=require("./setPrototypeOf");function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)setPrototypeOf(subClass,superClass)}module.exports=_inherits},{"./setPrototypeOf":10}],7:[function(require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_interopRequireDefault},{}],8:[function(require,module,exports){function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}module.exports=_isNativeFunction},{}],9:[function(require,module,exports){var _typeof=require("../helpers/typeof");var assertThisInitialized=require("./assertThisInitialized");function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return assertThisInitialized(self)}module.exports=_possibleConstructorReturn},{"../helpers/typeof":11,"./assertThisInitialized":1}],10:[function(require,module,exports){function _setPrototypeOf(o,p){module.exports=_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}module.exports=_setPrototypeOf},{}],11:[function(require,module,exports){function _typeof2(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof2=function _typeof2(obj){return typeof obj}}else{_typeof2=function _typeof2(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof2(obj)}function _typeof(obj){if(typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"){module.exports=_typeof=function _typeof(obj){return _typeof2(obj)}}else{module.exports=_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)}}return _typeof(obj)}module.exports=_typeof},{}],12:[function(require,module,exports){var getPrototypeOf=require("./getPrototypeOf");var setPrototypeOf=require("./setPrototypeOf");var isNativeFunction=require("./isNativeFunction");var construct=require("./construct");function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map:undefined;module.exports=_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return construct(Class,arguments,getPrototypeOf(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return setPrototypeOf(Wrapper,Class)};return _wrapNativeSuper(Class)}module.exports=_wrapNativeSuper},{"./construct":3,"./getPrototypeOf":5,"./isNativeFunction":8,"./setPrototypeOf":10}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MVC_VIEW_ELEMENT=exports.MVC_INPUT_CHANGED=exports.MVC_PROPERTY_CHANGED=exports.MVC_MODEL_MODIFIED=exports.MVC_CHECK_GROUP=exports.MVC_RADIO_GROUP=exports.MVC_CONTROLS=exports.MVC_OBSERVES=void 0;var APP_PREFIX="mvc";var MVC_OBSERVES="".concat(APP_PREFIX,"-observes");exports.MVC_OBSERVES=MVC_OBSERVES;var MVC_CONTROLS="".concat(APP_PREFIX,"-controls");exports.MVC_CONTROLS=MVC_CONTROLS;var MVC_RADIO_GROUP="".concat(APP_PREFIX,"-radio-group");exports.MVC_RADIO_GROUP=MVC_RADIO_GROUP;var MVC_CHECK_GROUP="".concat(APP_PREFIX,"-check-group");exports.MVC_CHECK_GROUP=MVC_CHECK_GROUP;var MVC_MODEL_MODIFIED="".concat(APP_PREFIX,"-model-modified");exports.MVC_MODEL_MODIFIED=MVC_MODEL_MODIFIED;var MVC_PROPERTY_CHANGED="".concat(APP_PREFIX,"-property-changed");exports.MVC_PROPERTY_CHANGED=MVC_PROPERTY_CHANGED;var MVC_INPUT_CHANGED="".concat(APP_PREFIX,"-input-changed");exports.MVC_INPUT_CHANGED=MVC_INPUT_CHANGED;var MVC_VIEW_ELEMENT="".concat(APP_PREFIX,"-view");exports.MVC_VIEW_ELEMENT=MVC_VIEW_ELEMENT},{}],14:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _wrapNativeSuper2=_interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));var _view=_interopRequireDefault(require("../view"));var _model=_interopRequireDefault(require("../model"));var MVCView=function(_HTMLElement){(0,_inherits2["default"])(MVCView,_HTMLElement);function MVCView(){(0,_classCallCheck2["default"])(this,MVCView);return(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(MVCView).call(this))}(0,_createClass2["default"])(MVCView,[{key:"connectedCallback",value:function connectedCallback(){this._shadow=this.attachShadow({mode:"open"});var formNode=document.createElement("form");var slot=document.createElement("slot");formNode.append(slot);this._shadow.appendChild(formNode)}},{key:"model",get:function get(){return this._model},set:function set(model){if(this._model){throw new Error("The model may only be set once.")}this._model=new _model["default"](model);this._view=new _view["default"](this,this._model)}}]);return MVCView}((0,_wrapNativeSuper2["default"])(HTMLElement));exports["default"]=MVCView},{"../model":17,"../view":18,"@babel/runtime/helpers/classCallCheck":2,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/getPrototypeOf":5,"@babel/runtime/helpers/inherits":6,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/helpers/possibleConstructorReturn":9,"@babel/runtime/helpers/wrapNativeSuper":12}],15:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var EventEmitter=function(){function EventEmitter(){(0,_classCallCheck2["default"])(this,EventEmitter);this.listeners={}}(0,_createClass2["default"])(EventEmitter,[{key:"addEventListener",value:function addEventListener(type,callback){if(!(type in this.listeners)){this.listeners[type]=[]}this.listeners[type].push(callback)}},{key:"removeEventListener",value:function removeEventListener(type,callback){if(!(type in this.listeners)){return}var stack=this.listeners[type];for(var i=0,l=stack.length;i<l;i++){if(stack[i]===callback){stack.splice(i,1);return}}}},{key:"dispatchEvent",value:function dispatchEvent(event){if(!(event.type in this.listeners)){return true}var stack=this.listeners[event.type].slice();for(var i=0,l=stack.length;i<l;i++){stack[i].call(this,event)}return!event.defaultPrevented}},{key:"listensFor",value:function listensFor(type){return!!this.listeners[type]}},{key:"hasListener",value:function hasListener(type,callback){return!!this.listeners[type]?this.listeners[type].indexOf(callback)>=0:false}}]);return EventEmitter}();exports["default"]=EventEmitter},{"@babel/runtime/helpers/classCallCheck":2,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":7}],16:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"Model",{enumerable:true,get:function get(){return _model["default"]}});Object.defineProperty(exports,"View",{enumerable:true,get:function get(){return _view["default"]}});Object.defineProperty(exports,"EventEmitter",{enumerable:true,get:function get(){return _eventEmitter["default"]}});var _model=_interopRequireDefault(require("./model"));var _view=_interopRequireDefault(require("./view"));var _eventEmitter=_interopRequireDefault(require("./event-emitter"));var _mvcView=_interopRequireDefault(require("./custom-elements/mvc-view"));var _config=require("./config");window.customElements.define(_config.MVC_VIEW_ELEMENT,_mvcView["default"])},{"./config":13,"./custom-elements/mvc-view":14,"./event-emitter":15,"./model":17,"./view":18,"@babel/runtime/helpers/interopRequireDefault":7}],17:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _eventEmitter=_interopRequireDefault(require("./event-emitter"));var _config=require("./config");var Model=function(_EventEmitter){(0,_inherits2["default"])(Model,_EventEmitter);function Model(dataModel){var _this;(0,_classCallCheck2["default"])(this,Model);_this=(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(Model).call(this));var _loop=function _loop(){var k=_Object$keys[_i];Object.defineProperty((0,_assertThisInitialized2["default"])(_this),k,{innumerable:true,get:function get(){return dataModel[k]},set:function set(val){dataModel[k]=val;var e=new CustomEvent(_config.MVC_PROPERTY_CHANGED,{detail:{model:dataModel,property:k,value:val}});_this.dispatchEvent(e)}})};for(var _i=0,_Object$keys=Object.keys(dataModel);_i<_Object$keys.length;_i++){_loop()}Object.defineProperty((0,_assertThisInitialized2["default"])(_this),"model",{innumerable:true,get:function get(){return dataModel}});var modify=function modify(val){Object.assign(dataModel,val);var e=new CustomEvent(_config.MVC_MODEL_MODIFIED,{detail:{updates:val,model:dataModel,properties:[Object.keys(val)],values:[Object.values(val)]}});_this.dispatchEvent(e)};Object.defineProperty((0,_assertThisInitialized2["default"])(_this),"modify",{value:modify});return _this}return Model}(_eventEmitter["default"]);exports["default"]=Model},{"./config":13,"./event-emitter":15,"@babel/runtime/helpers/assertThisInitialized":1,"@babel/runtime/helpers/classCallCheck":2,"@babel/runtime/helpers/getPrototypeOf":5,"@babel/runtime/helpers/inherits":6,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/helpers/possibleConstructorReturn":9}],18:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _config=require("./config");var _eventEmitter=_interopRequireDefault(require("./event-emitter"));var View=function(_EventEmitter){(0,_inherits2["default"])(View,_EventEmitter);function View(viewDOM,model){var _this;(0,_classCallCheck2["default"])(this,View);_this=(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(View).call(this));var observers=viewDOM.querySelectorAll("[".concat(_config.MVC_OBSERVES,"]"));var controls=viewDOM.querySelectorAll("[".concat(_config.MVC_CONTROLS,"]"));var radioGroupObservers=viewDOM.querySelectorAll("[".concat(_config.MVC_OBSERVES,"][").concat(_config.MVC_RADIO_GROUP,"]"));var radioGroupControls=viewDOM.querySelectorAll("[".concat(_config.MVC_CONTROLS,"][").concat(_config.MVC_RADIO_GROUP,"]"));var checkGroupObservers=viewDOM.querySelectorAll("[".concat(_config.MVC_OBSERVES,"][").concat(_config.MVC_CHECK_GROUP,"]"));var checkGroupControls=viewDOM.querySelectorAll("[".concat(_config.MVC_CONTROLS,"][").concat(_config.MVC_CHECK_GROUP,"]"));radioGroupObservers=Array.prototype.map.call(radioGroupObservers,function(o){return o});radioGroupControls=Array.prototype.map.call(radioGroupControls,function(c){return c});checkGroupObservers=Array.prototype.map.call(checkGroupObservers,function(o){return o});checkGroupControls=Array.prototype.map.call(checkGroupControls,function(c){return c});function getInputValue(control){var inputType=control.getAttribute("type");switch(inputType){case"button":case"file":case"image":case"password":case"reset":case"submit":throw new TypeError("Inputs of type ".concat(inputType," cannot observe models"));break;case"checkbox":return control.checked;break;default:return control.value;break}}function getControlValue(control){switch(control.tagName){case"INPUT":return getInputValue(control);case"FIELDSET":return fieldsetGetAdapter.get(control)();case"SELECT":return control.value;default:return control.innerHTML}}function updateInputValue(observer,value){var inputType=observer.getAttribute("type");switch(inputType){case"button":case"file":case"image":case"reset":case"submit":throw new TypeError("Inputs of type ".concat(inputType," do not have values"));break;case"password":throw new TypeError("Inputs of type ".concat(inputType," may not be modified by controllers"));case"checkbox":observer.checked=value;break;default:observer.value=value;break}}function updateObserver(observer,value){switch(observer.tagName){case"INPUT":updateInputValue(observer,value);break;case"FIELDSET":if(observer.hasAttribute(_config.MVC_RADIO_GROUP)&&!fieldsetOptionsMap.get(observer).includes(value)){throw new RangeError("The value supplied, ".concat(value,", is not a valid option"))}else if(observer.hasAttribute(_config.MVC_CHECK_GROUP)&&Object.keys(value).filter(function(v){return!fieldsetOptionsMap.get(observer).includes(v)}).length){throw new RangeError("At least one of the values supplied, ".concat(value,", is not a valid option"))}fieldsetSetAdapter.get(observer)(value);break;case"SELECT":if(!selectOptionsMap.get(observer).includes(value)){throw new RangeError("The value supplied, ".concat(value,", is not a valid option"))}observer.value=value;break;default:observer.innerHTML=value;break}}var fieldsetGetAdapter=new Map;var _loop=function _loop(i){var addEventListeners=function addEventListeners(c){var _loop3=function _loop3(val){c.addEventListener("change",function(e){var ce=new CustomEvent(_config.MVC_INPUT_CHANGED,{target:e.target,detail:{property:controlledValues[val],value:getControlValue(controls[i])}});model[controlledValues[val]]=getControlValue(controls[i]);_this.dispatchEvent(ce)})};for(var val in controlledValues){_loop3(val)}};var controlledValues=controls[i].getAttribute(_config.MVC_CONTROLS).split(",");if(radioGroupControls.includes(controls[i])){var radioGroupName=controls[i].getAttribute(_config.MVC_RADIO_GROUP);var radioForm=controls[i].closest("form");var nodeList=radioForm?radioForm.elements[radioGroupName]:document.getElementsByName(radioGroupName);fieldsetGetAdapter.set(controls[i],radioForm?function(){return nodeList.value}:function(){return controls[i].querySelector(":checked").value});nodeList.forEach(function(n){addEventListeners(n)})}else if(checkGroupControls.includes(controls[i])){var _nodeList=controls[i].querySelectorAll('[type="checkbox"]');fieldsetGetAdapter.set(controls[i],function(){var result={};_nodeList.forEach(function(n){result[n.value]=n.checked});return result});_nodeList.forEach(function(n){addEventListeners(n)})}else{addEventListeners(controls[i])}};for(var i=0;i<controls.length;i++){_loop(i)}var fieldsetOptionsMap=new Map;var selectOptionsMap=new Map;var fieldsetSetAdapter=new Map;var _loop2=function _loop2(i){if(radioGroupObservers.includes(observers[i])){var radioGroupName=observers[i].getAttribute(_config.MVC_RADIO_GROUP);var radioForm=observers[i].closest("form");var nodeList=radioForm?radioForm.elements[radioGroupName]:document.getElementsByName(radioGroupName);fieldsetSetAdapter.set(observers[i],radioForm?function(val){return nodeList.value=val}:function(val){return nodeList.forEach(function(n){n.checked=false;if(n.value===val){n.checked=true}})});var options=[];nodeList.forEach(function(o){options.push(o.value)});fieldsetOptionsMap.set(observers[i],options)}else if(checkGroupObservers.includes(observers[i])){var _nodeList2=observers[i].querySelectorAll('[type="checkbox"]');fieldsetSetAdapter.set(observers[i],function(val){_nodeList2.forEach(function(n){n.checked=val[n.value]})});var _options=[];_nodeList2.forEach(function(o){_options.push(o.value)});fieldsetOptionsMap.set(observers[i],_options)}else if(observers[i].tagName==="SELECT"){var _options2=[];observers[i].querySelectorAll("option").forEach(function(o){_options2.push(o.value)});selectOptionsMap.set(observers[i],_options2)}var observedValues=observers[i].getAttribute(_config.MVC_OBSERVES).split(",");var _loop4=function _loop4(val){model.addEventListener(_config.MVC_PROPERTY_CHANGED,function(e){if(observedValues[val]===e.detail.property&&e.target!==observers[i]){updateObserver(observers[i],e.detail.value)}})};for(var val in observedValues){_loop4(val)}};for(var i=0;i<observers.length;i++){_loop2(i)}model.addEventListener(_config.MVC_MODEL_MODIFIED,function(e){for(var i=0;i<observers.length;i++){var observedValues=observers[i].getAttribute(_config.MVC_OBSERVES).split(",");for(var val in observedValues){var updatedVal=e.detail.updates[observedValues[val]];if(updatedVal){updateObserver(observers[i],updatedVal)}}}});return _this}return View}(_eventEmitter["default"]);exports["default"]=View},{"./config":13,"./event-emitter":15,"@babel/runtime/helpers/classCallCheck":2,"@babel/runtime/helpers/getPrototypeOf":5,"@babel/runtime/helpers/inherits":6,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/helpers/possibleConstructorReturn":9}]},{},[16])(16)});
