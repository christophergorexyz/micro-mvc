{"version":3,"sources":["../src/index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA;IACM,e;;;AACJ,6BAAc;AAAA;AACZ,SAAK,SAAL,GAAiB,EAAjB;AACD;;;;qCAEgB,I,EAAM,Q,EAAU;AAC/B,UAAI,EAAE,IAAI,IAAI,KAAK,SAAf,CAAJ,EAA+B;AAC7B,aAAK,SAAL,CAAe,IAAf,IAAuB,EAAvB;AACD;;AACD,WAAK,SAAL,CAAe,IAAf,EAAqB,IAArB,CAA0B,QAA1B;AACD;;;wCAEmB,I,EAAM,Q,EAAU;AAClC,UAAI,EAAE,IAAI,IAAI,KAAK,SAAf,CAAJ,EAA+B;AAC7B;AACD;;AACD,UAAI,KAAK,GAAG,KAAK,SAAL,CAAe,IAAf,CAAZ;;AACA,WAAK,IAAI,CAAC,GAAG,CAAR,EAAW,CAAC,GAAG,KAAK,CAAC,MAA1B,EAAkC,CAAC,GAAG,CAAtC,EAAyC,CAAC,EAA1C,EAA8C;AAC5C,YAAI,KAAK,CAAC,CAAD,CAAL,KAAa,QAAjB,EAA2B;AACzB,UAAA,KAAK,CAAC,MAAN,CAAa,CAAb,EAAgB,CAAhB;AACA;AACD;AACF;AACF;;;kCAEa,K,EAAO;AACnB,UAAI,EAAE,KAAK,CAAC,IAAN,IAAc,KAAK,SAArB,CAAJ,EAAqC;AACnC,eAAO,IAAP;AACD;;AACD,UAAI,KAAK,GAAG,KAAK,SAAL,CAAe,KAAK,CAAC,IAArB,EAA2B,KAA3B,EAAZ;;AAEA,WAAK,IAAI,CAAC,GAAG,CAAR,EAAW,CAAC,GAAG,KAAK,CAAC,MAA1B,EAAkC,CAAC,GAAG,CAAtC,EAAyC,CAAC,EAA1C,EAA8C;AAC5C,QAAA,KAAK,CAAC,CAAD,CAAL,CAAS,IAAT,CAAc,IAAd,EAAoB,KAApB;AACD;;AACD,aAAO,CAAC,KAAK,CAAC,gBAAd;AACD;;;;;IAGG,K;;;;;AACJ,iBAAY,SAAZ,EAAuB;AAAA;;AAAA;AACrB;;AADqB;AAEhB,UAAI,CAAC,mBAAL;AAEH,MAAA,MAAM,CAAC,cAAP,iDAA4B,CAA5B,EAA+B;AAC7B,QAAA,WAAW,EAAE,IADgB;AAE7B,QAAA,GAAG,EAAE,eAAM;AACT,iBAAO,SAAS,CAAC,CAAD,CAAhB;AACD,SAJ4B;AAK7B,QAAA,GAAG,EAAE,aAAC,GAAD,EAAS;AACZ,UAAA,SAAS,CAAC,CAAD,CAAT,GAAe,GAAf;AACA,cAAI,CAAC,GAAG,IAAI,WAAJ,wBAAuC;AAC7C,YAAA,MAAM,EAAE;AACN,cAAA,KAAK,EAAE,SADD;AAEN,cAAA,QAAQ,EAAE,CAFJ;AAGN,cAAA,KAAK,EAAE;AAHD;AADqC,WAAvC,CAAR;;AAOA,gBAAK,aAAL,CAAmB,CAAnB;AACD;AAf4B,OAA/B;AAJmB;;AAErB,oCAAc,MAAM,CAAC,IAAP,CAAY,SAAZ,CAAd,kCAAsC;AAAA;AAmBrC,KArBoB,CAuBrB;;;AACA,IAAA,MAAM,CAAC,cAAP,iDAA4B,OAA5B,EAAqC;AACnC,MAAA,WAAW,EAAE,IADsB;AAEnC,MAAA,GAAG,EAAE,eAAM;AACT,eAAO,SAAP;AACD;AAJkC,KAArC;;AAOA,QAAI,MAAM,GAAG,SAAT,MAAS,CAAC,GAAD,EAAS;AACpB,MAAA,MAAM,CAAC,MAAP,CAAc,SAAd,EAAyB,GAAzB,EADoB,CAEpB;AACA;AACA;AACA;AACA;;AACA,UAAI,CAAC,GAAG,IAAI,WAAJ,CAAgB,mBAAhB,EAAqC;AAC3C,QAAA,MAAM,EAAE;AACN,UAAA,OAAO,EAAE,GADH;AAEN,UAAA,KAAK,EAAE,SAFD;AAGN,UAAA,UAAU,EAAE,CAAC,MAAM,CAAC,IAAP,CAAY,GAAZ,CAAD,CAHN;AAIN,UAAA,MAAM,EAAE,CAAC,MAAM,CAAC,MAAP,CAAc,GAAd,CAAD;AAJF;AADmC,OAArC,CAAR;;AASA,YAAK,aAAL,CAAmB,CAAnB;AACD,KAjBD;;AAmBA,IAAA,MAAM,CAAC,cAAP,iDAA4B,QAA5B,EAAsC;AACpC,MAAA,KAAK,EAAE;AAD6B,KAAtC;AAlDqB;AAqDtB;;;EAtDiB,e;;;;IA0Dd,I;;;;;AACJ,gBAAY,OAAZ,EAAqB,KAArB,EAA4B;AAAA;;AAAA;AAC1B;AAEA,QAAI,SAAS,GAAG,OAAO,CAAC,gBAAR,CAAyB,gBAAzB,CAAhB;AACA,QAAI,QAAQ,GAAG,OAAO,CAAC,gBAAR,CAAyB,gBAAzB,CAAf;;AAGA,aAAS,eAAT,CAAyB,OAAzB,EAAkC;AAChC,cAAQ,OAAO,CAAC,OAAhB;AACE,aAAK,OAAL;AACE,iBAAO,OAAO,CAAC,KAAf;AACA;AACA;;AACF;AACE,iBAAO,OAAO,CAAC,SAAf;AANJ;AAQD;;AAED,aAAS,cAAT,CAAwB,QAAxB,EAAkC,KAAlC,EAAyC;AACvC,cAAQ,QAAQ,CAAC,OAAjB;AACE;AACA;AACA,aAAK,OAAL;AACE,UAAA,QAAQ,CAAC,KAAT,GAAiB,KAAjB;AACA;AACF;;AACA;AACE,UAAA,QAAQ,CAAC,SAAT,GAAqB,KAArB;AACA;AATJ;AAWD;;AA9ByB,iCAgCjB,CAhCiB;AAiCxB,UAAI,gBAAgB,GAAG,QAAQ,CAAC,CAAD,CAAR,CAAY,YAAZ,CAAyB,cAAzB,EAAyC,KAAzC,CAA+C,GAA/C,CAAvB;;AAjCwB,mCAkCf,GAlCe;AAmCtB,QAAA,QAAQ,CAAC,CAAD,CAAR,CAAY,gBAAZ,CAA6B,QAA7B,EAAuC,UAAC,CAAD,EAAO;AAC5C,cAAI,EAAE,GAAG,IAAI,WAAJ,qBAAoC;AAC3C,YAAA,MAAM,EAAE,CAAC,CAAC,MADiC;AAE3C,YAAA,MAAM,EAAE;AACN,cAAA,QAAQ,EAAE,gBAAgB,CAAC,GAAD,CADpB;AAEN,cAAA,KAAK,EAAE,eAAe,CAAC,QAAQ,CAAC,CAAD,CAAT;AAFhB;AAFmC,WAApC,CAAT;AAOA,UAAA,KAAK,CAAC,gBAAgB,CAAC,GAAD,CAAjB,CAAL,GAA+B,eAAe,CAAC,QAAQ,CAAC,CAAD,CAAT,CAA9C;;AACA,iBAAK,aAAL,CAAmB,EAAnB;AACD,SAVD;AAnCsB;;AAkCxB,WAAK,IAAI,GAAT,IAAgB,gBAAhB,EAAkC;AAAA,eAAzB,GAAyB;AAYjC;AA9CuB;;AAgC1B,SAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,QAAQ,CAAC,MAA7B,EAAqC,CAAC,EAAtC,EAA0C;AAAA,aAAjC,CAAiC;AAezC;;AA/CyB,iCAiDjB,CAjDiB;AAkDxB,UAAI,cAAc,GAAG,SAAS,CAAC,CAAD,CAAT,CAAa,YAAb,CAA0B,cAA1B,EAA0C,KAA1C,CAAgD,GAAhD,CAArB;;AAlDwB,mCAmDf,GAnDe;AAoDtB,QAAA,KAAK,CAAC,gBAAN,wBAA8C,UAAC,CAAD,EAAO;AACnD,cAAI,cAAc,CAAC,GAAD,CAAd,KAAwB,CAAC,CAAC,MAAF,CAAS,QAAjC,IAA6C,CAAC,CAAC,MAAF,KAAa,SAAS,CAAC,CAAD,CAAvE,EAA4E;AAC1E,YAAA,cAAc,CAAC,SAAS,CAAC,CAAD,CAAV,EAAe,CAAC,CAAC,MAAF,CAAS,KAAxB,CAAd;AACD;AACF,SAJD;AApDsB;;AAmDxB,WAAK,IAAI,GAAT,IAAgB,cAAhB,EAAgC;AAAA,eAAvB,GAAuB;AAM/B;AAzDuB;;AAiD1B,SAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,SAAS,CAAC,MAA9B,EAAsC,CAAC,EAAvC,EAA2C;AAAA,aAAlC,CAAkC;AAS1C;;AAED,IAAA,KAAK,CAAC,gBAAN,sBAA4C,UAAC,CAAD,EAAO;AACjD,WAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,SAAS,CAAC,MAA9B,EAAsC,CAAC,EAAvC,EAA2C;AACzC,YAAI,cAAc,GAAG,SAAS,CAAC,CAAD,CAAT,CAAa,YAAb,CAA0B,cAA1B,EAA0C,KAA1C,CAAgD,GAAhD,CAArB;;AACA,aAAK,IAAI,GAAT,IAAgB,cAAhB,EAAgC;AAC9B,UAAA,cAAc,CAAC,SAAS,CAAC,CAAD,CAAV,EAAe,CAAC,CAAC,MAAF,CAAS,OAAT,CAAiB,cAAc,CAAC,GAAD,CAA/B,CAAf,CAAd;AACD;AACF;AACF,KAPD;AA5D0B;AAoE3B;;;EArEgB,e","file":"micro-mvc.js","sourcesContent":["//MVCEventEmitter class slightly modified from\n//https://developer.mozilla.org/en-US/docs/Web/API/EventTarget#_Simple_implementation_of_EventTarget\nclass MVCEventEmitter {\n  constructor() {\n    this.listeners = {};\n  }\n\n  addEventListener(type, callback) {\n    if (!(type in this.listeners)) {\n      this.listeners[type] = [];\n    }\n    this.listeners[type].push(callback);\n  }\n\n  removeEventListener(type, callback) {\n    if (!(type in this.listeners)) {\n      return;\n    }\n    var stack = this.listeners[type];\n    for (var i = 0, l = stack.length; i < l; i++) {\n      if (stack[i] === callback) {\n        stack.splice(i, 1);\n        return;\n      }\n    }\n  }\n\n  dispatchEvent(event) {\n    if (!(event.type in this.listeners)) {\n      return true;\n    }\n    var stack = this.listeners[event.type].slice();\n\n    for (var i = 0, l = stack.length; i < l; i++) {\n      stack[i].call(this, event);\n    }\n    return !event.defaultPrevented;\n  }\n}\n\nclass Model extends MVCEventEmitter {\n  constructor(dataModel) {\n    super();\n    for (let k of Object.keys(dataModel)) {\n\n      Object.defineProperty(this, k, {\n        innumerable: true,\n        get: () => {\n          return dataModel[k];\n        },\n        set: (val) => {\n          dataModel[k] = val;\n          let e = new CustomEvent(`mvc-propertychanged`, {\n            detail: {\n              model: dataModel,\n              property: k,\n              value: val\n            }\n          });\n          this.dispatchEvent(e);\n        }\n      });\n    }\n\n    //TODO: determine whether access to the model is required\n    Object.defineProperty(this, 'model', {\n      innumerable: true,\n      get: () => {\n        return dataModel;\n      }\n    });\n\n    let modify = (val) => {\n      Object.assign(dataModel, val);\n      //In some situations, it may be too computationally\n      //intensive to make updates to all listeners to model,\n      //so providing a list of the properties and values that\n      //were changed and the raw val object as \"updates\" so\n      //that only the updates are necessary to process\n      let e = new CustomEvent('mvc-modelmodified', {\n        detail: {\n          updates: val,\n          model: dataModel,\n          properties: [Object.keys(val)],\n          values: [Object.values(val)]\n        }\n      });\n\n      this.dispatchEvent(e);\n    };\n\n    Object.defineProperty(this, 'modify', {\n      value: modify\n    });\n  }\n\n}\n\nclass View extends MVCEventEmitter {\n  constructor(viewDOM, model) {\n    super();\n\n    let observers = viewDOM.querySelectorAll('[mvc-observes]');\n    let controls = viewDOM.querySelectorAll('[mvc-controls]');\n\n\n    function getControlValue(control) {\n      switch (control.tagName) {\n        case \"INPUT\":\n          return control.value;\n          //case \"TEXTAREA\":\n          //return control.innerHTML;\n        default:\n          return control.innerHTML;\n      }\n    }\n\n    function updateObserver(observer, value) {\n      switch (observer.tagName) {\n        //TODO: write adapter for each observer\n        //TODO: implement custom handlers\n        case \"INPUT\":\n          observer.value = value;\n          break;\n        //case \"SELECT\":\n        default:\n          observer.innerHTML = value;\n          break;\n      }\n    }\n\n    for (let i = 0; i < controls.length; i++) {\n      let controlledValues = controls[i].getAttribute('mvc-controls').split(',');\n      for (let val in controlledValues) {\n        controls[i].addEventListener('change', (e) => {\n          let ce = new CustomEvent(`mvc-inputchanged`, {\n            target: e.target,\n            detail: {\n              property: controlledValues[val],\n              value: getControlValue(controls[i])\n            }\n          });\n          model[controlledValues[val]] = getControlValue(controls[i]);\n          this.dispatchEvent(ce);\n        });\n      }\n    }\n\n    for (let i = 0; i < observers.length; i++) {\n      let observedValues = observers[i].getAttribute('mvc-observes').split(',');\n      for (let val in observedValues) {\n        model.addEventListener(`mvc-propertychanged`, (e) => {\n          if (observedValues[val] === e.detail.property && e.target !== observers[i]) {\n            updateObserver(observers[i], e.detail.value);\n          }\n        });\n      }\n    }\n\n    model.addEventListener(`mvc-modelmodified`, (e) => {\n      for (let i = 0; i < observers.length; i++) {\n        let observedValues = observers[i].getAttribute('mvc-observes').split(',');\n        for (let val in observedValues) {\n          updateObserver(observers[i], e.detail.updates[observedValues[val]]);\n        }\n      }\n    });\n  }\n}\n\nexport {\n  Model,\n  View\n};\n"]}