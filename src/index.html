<!DOCUMENT html>
<html>

<head>
  <title>MVC-Test</title>
  <script type="text/javascript" src="js/index.js"></script>
  <style>
    .application-container form *{
          box-sizing: border-box;
      }
      .application-container form {
        width: 500px;
      }
      .application-container form,
      .application-container canvas{
        display:inline-block;
        vertical-align: top;
        border: 1px solid black;
      }
      .application-container form div{
        width:100%;
        font-size: 0;
      }
      .application-container form input,
      .application-container form label {
        font-size:initial;
        display:inline-block;
        width:50%;
      }
      .application-container form label{
        text-align: right;
        padding-right:1em;
      }
      .application-container form input {
        text-align: left;
        padding-left:1em;
      }
  </style>
</head>

<body class="application-container">
  <div class="application-name" mvc-observes-name>
  </div>
  <form>
    <div>
      <label for="x">x:</label>
      <input type="number" name="x" mvc-controls="x" mvc-observes="x" value="0" />
    </div>
    <div>
      <label for="y">y:</label>
      <input type="number" name="y" mvc-controls="y" mvc-observes="y" value="0" />
    </div>
  </form>
  <canvas width="500px" height="500px" mvc-controls="x,y" mvc-observes="x,y"></canvas>
  <script type="text/javascript">
    let application = {
      name: 'Observability Tester',
      version: '0.0.1'
    };

    let coordinates = {
      x: 0,
      y: 0
    };

    let Model = mvc.Model;
    let View = mvc.View;
    let Control = mvc.Control;

    let applicationContainer = '.application-container';

    let coordinateModel = new Model(coordinates);
    let applicationModel = new Model(application);

    let coordinateFormElement = document.querySelector(`${applicationContainer} form`);
    let coordinateFormView = new View(coordinateFormElement, coordinateModel);

    let canvas = document.querySelector(`${applicationContainer} canvas`);
    let context = canvas.getContext('2d');

    canvas.addEventListener('mouseup', (e) => {
      coordinateModel.modify({
        x: e.clientX - canvas.offsetLeft,
        y: e.clientY - canvas.offsetTop
      });
    });

    function updateModel(e) {
      coordinateModel[e.target] = e.val;
    }

    function updateCanvas(e) {
      context.clearRect(0, 0, canvas.width, canvas.height);
      context.fillStyle = 'rgb(0,0,0)';
      context.fillRect(coordinateModel.x - 5, coordinateModel.y - 5, 10, 10);
    }

    coordinateModel.addEventListener('mvc-propertychanged', updateCanvas);
    coordinateModel.addEventListener('mvc-inputchanged', updateCanvas);
    coordinateModel.addEventListener('mvc-modelmodified', updateCanvas);

    applicationNameElement = document.querySelector(`${applicationContainer} .application-name`);

    applicationModel.addEventListener('mvc-propertychanged-name', (e) => applicationNameElement.innerHTML = e.detail.value);
    applicationModel.name = applicationModel.name;

  </script>
</body>

</html>
